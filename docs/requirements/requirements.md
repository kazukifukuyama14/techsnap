# 要件定義書

## 概要

個人利用向けの技術記事要約サービスを開発する。このサービスは、技術記事の URL を入力することで、ChatLLM API を利用して記事の内容を要約し、効率的な情報収集を支援することを目的とする。

## 要件

### 要件 1

**ユーザーストーリー:** 技術者として、記事の URL を入力して要約を取得したい。効率的に技術情報を収集するため。

#### 要件 1 の受け入れ基準

1. ユーザーが記事 URL を入力した時、システムは URL の妥当性を検証する
2. 有効な URL が入力された時、システムは記事の内容を取得する
3. 記事内容が取得された時、システムは ChatLLM API を使用して要約を生成する
4. 要約が生成された時、システムは要約結果をユーザーに表示する

### 要件 2

**ユーザーストーリー:** 技術者として、要約した記事を保存・管理したい。後で参照するため。

#### 要件 2 の受け入れ基準

1. 要約が生成された時、システムは要約結果を Firestore に保存する
2. ユーザーが過去の要約を閲覧したい時、システムは保存された要約一覧を表示する
3. ユーザーが要約を検索したい時、システムはタイトルやタグで検索機能を提供する
4. ユーザーが要約を削除したい時、システムは選択した要約を削除する

### 要件 3

**ユーザーストーリー:** 開発者として、ステージング環境と本番環境を分離したい。安全にサービスを運用するため。

#### 要件 3 の受け入れ基準

1. ステージング環境にデプロイする時、システムは開発用の Firebase プロジェクトを使用する
2. 本番環境にデプロイする時、システムは本番用の Firebase プロジェクトを使用する
3. GitHub Actions でデプロイする時、システムは環境に応じた設定を自動適用する
4. ソースコードを管理する時、システムは単一の公開リポジトリで両環境を管理する
5. 機密情報を扱う時、システムは GitHub Secrets で環境別に管理する

### 要件 4

**ユーザーストーリー:** 運用者として、コストを最小限に抑えたい。個人利用で継続的に運用するため。

#### 要件 4 の受け入れ基準

1. インフラを構築する時、システムは Google Cloud Run を使用してコンテナをデプロイする
2. データベースを使用する時、システムは Firestore（無料枠内）を使用する
3. 認証機能を実装する時、システムは Firebase Authentication（無料枠内）を使用する
4. 静的ファイルを配信する時、システムは Firebase Hosting（無料枠内）を使用する

### 要件 5

**ユーザーストーリー:** 開発者として、インフラをコード管理したい。再現可能で保守しやすい構成にするため。

#### 要件 5 の受け入れ基準

1. インフラを構築する時、システムは Terraform を使用して IaC を実装する
2. ディレクトリ構成を設計する時、システムは LayerX アプローチに従ったフラット構造で管理する
3. 環境を分離する時、システムは環境ごとに tfvars ファイルを分ける
4. リソースを管理する時、システムは適切なタグ付けとネーミング規則を適用する

### 要件 6

**ユーザーストーリー:** 開発者として、CI/CD パイプラインを自動化したい。効率的にデプロイするため。

#### 受け入れ基準

1. コードがプッシュされた時、システムは自動でテストを実行する
2. テストが成功した時、システムは Docker イメージをビルドする
3. main ブランチにマージされた時、システムはステージング環境に自動デプロイする
4. release タグが作成された時、システムは本番環境に自動デプロイする

### 要件 7

**ユーザーストーリー:** ユーザーとして、レスポンシブな UI を使いたい。モバイルでも快適に利用するため。

#### 要件 7 の受け入れ基準

1. モバイルデバイスでアクセスする時、システムはモバイル最適化された UI を表示する
2. タブレットでアクセスする時、システムはタブレット最適化された UI を表示する
3. デスクトップでアクセスする時、システムはデスクトップ最適化された UI を表示する
4. ダークモードを選択する時、システムはダークテーマを適用する

### 要件 8

**ユーザーストーリー:** ユーザーとして、高速な要約生成を体験したい。ストレスなく利用するため。

#### 要件 8 の受け入れ基準

1. 要約処理が開始された時、システムは進行状況を表示する
2. 要約処理中にエラーが発生した時、システムは適切なエラーメッセージを表示する
3. 要約処理が完了した時、システムは 3 秒以内に結果を表示する
4. 同じ記事の要約が既に存在する時、システムはキャッシュされた結果を即座に表示する

### 要件 9

**ユーザーストーリー:** 開発者として、本番環境に独自ドメインを設定したい。プロフェッショナルなサービス提供のため。

#### 要件 9 の受け入れ基準

1. 本番環境を構築する時、システムは Google Cloud Domains で独自ドメインを購入する
2. ドメインを管理する時、システムは Cloud DNS で DNS 設定を行う
3. SSL 証明書を設定する時、システムは Google 管理の SSL 証明書を自動適用する
4. ステージング環境を使用する時、システムは DNS 設定を行わずローカル確認のみとする

### 要件 10

**ユーザーストーリー:** 開発者として、設定ファイルを安全に管理したい。機密情報の漏洩を防ぐため。

#### 要件 10 の受け入れ基準

1. Terraform 設定を管理する時、システムは.tfvars ファイルを Cloud Storage に保管する
2. Terraform ステートを管理する時、システムは Cloud Storage を Backend として使用する
3. 機密情報を扱う時、システムは暗号化されたストレージを使用する
4. 設定ファイルにアクセスする時、システムは適切な権限管理を行う

### 要件 11

**ユーザーストーリー:** 運用者として、AWS CloudWatch 相当の監視機能を使いたい。システムの健全性を把握するため。

#### 要件 11 の受け入れ基準

1. 監視を設定する時、システムは Google Cloud Monitoring リソースを含める
2. アラートを設定する時、システムは重要なメトリクスに対するアラートポリシーを作成する
3. ログを実装する時、システムは適切なログシンクを含む Cloud Logging を設定する
4. ダッシュボードを設定する時、システムは主要メトリクス用の監視ダッシュボードを作成する
5. 通知を設定する時、システムはアラート用の通知チャネルを設定する

### 要件 12

**ユーザーストーリー:** サイト信頼性エンジニアとして、ステージングと本番環境の両方で監視リソースを使いたい。すべての環境で適切な可観測性を維持するため。

#### 要件 12 の受け入れ基準

1. ステージングにデプロイする時、システムはステージング環境に適切な監視リソースを含める
2. 本番にデプロイする時、システムは本番環境に包括的な監視リソースを含める
3. アラートを設定する時、システはステージングと本番環境で異なるしきい値を設定する
4. ダッシュボードを設定する時、システムは環境固有の監視ダッシュボードを作成する

### 要件 13

**ユーザーストーリー:** ドキュメント管理者として、監視設定を含む新しい構造を説明する明確なドキュメントが欲しい。チームメンバーがインフラを理解・保守できるようにするため。

#### 要件 13 の受け入れ基準

1. 新しい構造を文書化する時、システムはディレクトリ組織の明確な説明を提供する
2. 監視を説明する時、システムはすべての監視リソースとその目的を文書化する
3. 例を提供する時、システムは一般的な監視シナリオの設定例を含める
4. ドキュメントを更新する時、システムはステアリングルールから確立されたドキュメント標準に従う

### 要件 14

**ユーザーストーリー:** コスト意識の高い開発者として、個人プロジェクトでコスト効率的な監視リソースを使いたい。過度なコストなしに可観測性を維持するため。

#### 要件 14 の受け入れ基準

1. 監視を設定する時、システムはコスト効率的な監視設定を使用する
2. アラートを設定する時、システムはコストを発生させる可能性のある過度なアラートを避ける
3. ログを実装する時、システムは適切なログ保持ポリシーを設定する
4. ダッシュボードを作成する時、システムはコストを最小化するために重要なメトリクスに焦点を当てる
