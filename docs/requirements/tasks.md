# 実装計画（マルチアカウント対応）

- [ ] 1. プロジェクト基盤セットアップ

  - Next.js プロジェクトの初期化と Tailwind CSS 設定
  - TypeScript 設定と ESLint/Prettier 設定
  - ディレクトリ構造の作成（components, pages, lib, types）
  - _要件: 1.1, 7.1, 7.2, 7.3_

- [ ] 2. マルチアカウント環境構築

  - [ ] 2.1 Google Cloud Organization 設定

    - Google Cloud Organization の確認・設定
    - 課金アカウントの設定
    - 組織レベルの IAM ポリシー設定
    - _要件: 5.1, 5.2_

  - [ ] 2.2 マルチアカウント作成

    - 管理アカウント（techsnap-mgmt）作成
    - ステージングアカウント（techsnap-staging）作成
    - 本番アカウント（techsnap-prod）作成
    - 各アカウントでの必要な API 有効化
    - _要件: 3.1, 3.2, 5.1_

  - [ ] 2.3 クロスアカウント IAM 設定
    - CI/CD 用サービスアカウント作成（管理アカウント）
    - ステージングアカウントへの権限付与
    - 本番アカウントへの制限付き権限付与
    - サービスアカウントキーの生成と Base64 エンコード
    - _要件: 3.4, 3.5, 5.4_

- [ ] 3. Firebase マルチプロジェクト設定

  - [ ] 3.1 Firebase プロジェクト作成と設定

    - ステージング用と本番用の Firebase プロジェクトを作成
    - Firebase SDK 設定と Next.js プロジェクトへの統合
    - 環境変数設定（.env.local, .env.example）
    - GitHub Secrets での環境別設定管理
    - _要件: 3.1, 3.2, 3.4, 3.5_

  - [ ] 3.2 Firebase Authentication 設定

    - 各環境での Firebase Authentication の有効化
    - Google 認証プロバイダーの設定
    - 認証コンテキストとフックの実装
    - 環境別認証設定の管理
    - _要件: 4.3_

  - [ ] 3.3 Firestore データベース設計実装
    - 各環境での Firestore セキュリティルールの作成
    - データモデル（Users, Summaries, Cache）の型定義
    - Firestore 操作用のヘルパー関数実装
    - 環境別データベース設定
    - _要件: 2.1, 2.2_

- [ ] 4. コア UI コンポーネント実装

  - [ ] 4.1 レイアウトコンポーネント作成

    - ヘッダー、フッター、サイドバーを含むレイアウト
    - レスポンシブデザインの実装
    - ダークモード切り替え機能
    - _要件: 7.1, 7.2, 7.3, 7.4_

  - [ ] 4.2 記事入力コンポーネント実装

    - URL 入力フォームとバリデーション
    - 入力状態管理とエラーハンドリング
    - 送信ボタンとローディング状態表示
    - _要件: 1.1, 1.2_

  - [ ] 4.3 要約表示コンポーネント実装
    - 要約結果の表示 UI
    - 保存・共有ボタンの実装
    - 展開/折りたたみ機能
    - _要件: 1.4, 2.1_

- [ ] 5. 記事スクレイピング機能実装

  - [ ] 5.1 記事コンテンツ取得 API 作成

    - Next.js API Routes で記事スクレイピングエンドポイント作成
    - Cheerio/Puppeteer を使用した記事内容抽出
    - URL 妥当性検証とエラーハンドリング
    - _要件: 1.1, 1.2_

  - [ ] 5.2 記事キャッシュ機能実装
    - Firestore を使用した記事コンテンツキャッシュ
    - キャッシュ有効期限管理
    - 重複記事の検出と既存キャッシュ利用
    - _要件: 8.4_

- [ ] 6. ChatLLM API 統合実装

  - [ ] 6.1 LLM API クライアント作成

    - ChatLLM API との通信クライアント実装
    - API キー管理とセキュリティ設定
    - レート制限とエラーハンドリング
    - _要件: 1.3_

  - [ ] 6.2 要約生成サービス実装
    - 記事コンテンツから要約を生成する関数
    - 要約オプション（長さ、スタイル）の設定
    - 進行状況表示とタイムアウト処理
    - _要件: 1.3, 8.1, 8.2, 8.3_

- [ ] 7. 要約管理機能実装

  - [ ] 7.1 要約保存機能実装

    - Firestore への要約データ保存
    - ユーザー認証との連携
    - 重複チェックと更新処理
    - _要件: 2.1_

  - [ ] 7.2 要約一覧表示機能実装

    - 保存済み要約の一覧表示コンポーネント
    - ページネーションと無限スクロール
    - 日付順・タイトル順ソート機能
    - _要件: 2.2_

  - [ ] 7.3 要約検索機能実装
    - タイトル・タグによる検索機能
    - リアルタイム検索とフィルタリング
    - 検索結果のハイライト表示
    - _要件: 2.3_

- [ ] 8. マルチアカウントインフラストラクチャ構築

  - [ ] 8.1 Terraform マルチアカウント設定

    - マルチアカウント対応プロバイダー設定（provider.tf）
    - アカウント別変数管理（locals.tf）
    - 管理アカウント用 Terraform ファイル作成
    - _要件: 5.1, 5.2, 5.3, 5.4_

  - [ ] 8.2 ステージング環境 Terraform ファイル作成

    - google_project_staging.tf でプロジェクト設定
    - google_cloudrun_staging.tf で Cloud Run 設定
    - google_firestore_staging.tf で Firestore 設定
    - google_iam_staging.tf で IAM 設定
    - google_monitoring_staging.tf で監視設定
    - _要件: 3.1, 4.1, 4.2_

  - [ ] 8.3 本番環境 Terraform ファイル作成

    - google_project_prod.tf でプロジェクト設定
    - google_cloudrun_prod.tf で Cloud Run 設定
    - google_firestore_prod.tf で Firestore 設定
    - google_dns_prod.tf、google_domains_prod.tf でドメイン・DNS 設定
    - google_iam_prod.tf で IAM 設定
    - google_monitoring_prod.tf で監視設定
    - _要件: 3.2, 4.1, 4.2, 4.3, 4.4_

  - [ ] 8.4 環境変数とバックエンド設定
    - backend.tf で Terraform Backend を Cloud Storage に設定
    - 管理アカウントでの Cloud Storage バケット作成
    - アカウント別.tfvars ファイル作成（mgmt.tfvars, staging.tfvars, production.tfvars）
    - Cloud Storage に.tfvars ファイルをアップロード・管理
    - _要件: 5.3, 10.3, 10.4_

- [ ] 9. Docker コンテナ設定

  - [ ] 9.1 Dockerfile 作成

    - Next.js アプリケーション用 Dockerfile 作成
    - マルチステージビルドによる最適化
    - セキュリティベストプラクティスの適用
    - _要件: 4.1_

  - [ ] 9.2 コンテナ最適化
    - イメージサイズの最小化
    - 非 root ユーザーでの実行設定
    - ヘルスチェック設定
    - _要件: 4.1_

- [ ] 10. マルチアカウント対応 CI/CD パイプライン構築

  - [ ] 10.1 GitHub Actions ワークフロー作成

    - ステージング環境用ワークフロー（develop ブランチ）
    - 本番環境用ワークフロー（main ブランチ）
    - マルチアカウント対応のデプロイ戦略
    - GitHub Environments 設定（staging/production）
    - _要件: 6.1, 6.2, 6.3, 6.4, 3.4, 3.5_

  - [ ] 10.2 GitHub Secrets 設定

    - マルチアカウント用プロジェクト ID 設定
    - CI/CD サービスアカウントキー設定
    - 環境別 Firebase 設定
    - ChatLLM API キーなど共通シークレット設定
    - _要件: 3.4, 3.5, 10.3, 10.4_

  - [ ] 10.3 自動テスト実装
    - ユニットテスト（Jest + React Testing Library）
    - 統合テスト（Firebase Emulator 使用）
    - E2E テスト（Playwright 使用）
    - 環境別テスト設定
    - _要件: 6.1_

- [ ] 11. エラーハンドリングと監視実装

  - [ ] 11.1 エラーハンドリング強化

    - グローバルエラーハンドラーの実装
    - ユーザーフレンドリーなエラーメッセージ
    - エラー報告とログ記録機能
    - 環境別エラー処理設定
    - _要件: 8.2_

  - [ ] 11.2 マルチアカウント監視設定
    - 各アカウントでの Google Cloud Monitoring 統合
    - アカウント別アプリケーションメトリクス収集
    - 環境別アラート設定とダッシュボード作成
    - クロスアカウント監視ダッシュボード
    - _要件: 8.3_

- [ ] 12. セキュリティ強化実装

  - [ ] 12.1 マルチアカウント認証・認可強化

    - 各環境での Firebase Security Rules 詳細設定
    - API エンドポイントの認証チェック
    - CSRF 保護とセキュリティヘッダー設定
    - アカウント間のセキュリティ境界確保
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [ ] 12.2 入力検証とサニタイゼーション
    - URL 入力の厳密なバリデーション
    - XSS 対策とコンテンツサニタイゼーション
    - レート制限と DDoS 保護
    - 環境別セキュリティ設定
    - _要件: 1.1_

- [ ] 13. パフォーマンス最適化実装

  - [ ] 13.1 フロントエンド最適化

    - Next.js Image Optimization 活用
    - コード分割と遅延読み込み実装
    - Service Worker によるキャッシュ戦略
    - _要件: 8.3, 8.4_

  - [ ] 13.2 バックエンド最適化
    - データベースクエリ最適化
    - API レスポンス圧縮
    - CDN 設定と静的アセット最適化
    - 環境別パフォーマンス設定
    - _要件: 8.3_

- [ ] 14. ドメイン設定（本番環境のみ）

  - [ ] 14.1 Google Cloud Domains でドメイン購入

    - 本番アカウントでのドメイン購入
    - ドメイン設定と DNS 管理
    - SSL/TLS 証明書の自動管理設定
    - _要件: 9.1, 9.2, 9.3_

  - [ ] 14.2 DNS 設定とカスタムドメイン
    - Cloud DNS でのドメイン管理設定
    - Cloud Run と Firebase Hosting でのカスタムドメイン設定
    - SSL 証明書の確認と設定
    - _要件: 9.1, 9.2, 9.3_

- [ ] 15. 最終統合テストと本番準備

  - [ ] 15.1 マルチアカウント統合テスト実行

    - 各環境での全機能の統合テスト実行
    - アカウント間の分離確認テスト
    - パフォーマンステストとロードテスト
    - セキュリティテストと脆弱性スキャン
    - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_

  - [ ] 15.2 本番環境デプロイ準備

    - 各アカウントの設定最終確認
    - バックアップとリカバリ手順確立
    - 監視とアラート設定の最終調整
    - マルチアカウント運用手順の確認
    - _要件: 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_

  - [ ] 15.3 運用開始準備
    - 各アカウントでのコスト監視設定
    - アカウント別権限管理の最終確認
    - 緊急時対応手順の確認
    - マルチアカウント運用ドキュメントの最終更新
    - _要件: 10.1, 10.2, 10.3, 10.4_
